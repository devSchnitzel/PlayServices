<html>
    <head>
        <title>Compatibility Summary Test</title>
    </head>
    <body>
        <script>
            function fetchBuilds() 
            {
                var apiBaseUrl = "http://localhost/playservices/server"
                var xhr = new XMLHttpRequest();
                xhr.open("GET", apiBaseUrl + "/api.php?endpoint=compatibility", true);
                xhr.setRequestHeader("Content-type", "application/json");
                xhr.onload = 
                    function()
                    {
                        if(xhr.status === 200)
                        {
                            var response = JSON.parse(xhr.responseText);
                            var updateStateSpan = 
                                function(stateName)
                                {
                                    {
                                        var state = response.find(function(elem) { return elem.state == stateName; });
                                        var element = document.getElementById(stateName + "-count");
                                        element.innerText = state.count; 
                                    }
                                    {
                                        var element = document.getElementById(stateName + "-link");
                                        element.setAttribute("href", "http://github.com/jpd002/Play-Compatibility/issues?utf8=%E2%9C%93&q=is:issue+is:open+label:" + stateName);
                                    }
                                };
                            updateStateSpan("state-playable");
                            updateStateSpan("state-ingame");
                            updateStateSpan("state-intro");
                            updateStateSpan("state-loadable");
                            updateStateSpan("state-nothing");
                        }
                        else
                        {
                            //fetchStatusElement.innerText = "Failed to obtain build info.";
                        }
                    };
                xhr.send();
            }
            fetchBuilds();
        </script>
        <div>
            <p><a id="state-playable-link">Playable</a>: <span id="state-playable-count"></span></p>
            <p><a id="state-ingame-link">In-Game</a>: <span id="state-ingame-count"></span></p>
            <p><a id="state-intro-link">Intro Only</a>: <span id="state-intro-count"></span></p>
            <p><a id="state-loadable-link">Loadable</a>: <span id="state-loadable-count"></span></p>
            <p><a id="state-nothing-link">Nothing</a>: <span id="state-nothing-count"></span></p>
        </div>
    </body>
</html>
